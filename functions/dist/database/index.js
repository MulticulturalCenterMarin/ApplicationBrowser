'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_lodash=require('lodash'),_lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var admin=require('firebase-admin'),databaseSearch=function(a){var b=a.entity,c=a.branch,d=c===void 0?[]:c,f=a.boundaries,g=f===void 0?{}:f,h=a.order,j=h===void 0?{}:h;return new Promise(function(k,l){var m=[],n=admin.database().ref('/'+b+'/'+_lodash2.default.join(d,'/'));j&&j.orderByKey&&(n=n.orderByKey()),j&&j.orderByChild&&(n=n.orderByChild(j.orderByChild)),j&&j.orderByValue&&(n=n.orderByValue(j.orderByValue)),g&&g.limitToFirst&&500>g.limitToFirst&&(n=n.limitToFirst(g.limitToFirst)),g&&g.limitToLast&&500>g.limitToLast&&(n=n.limitToLast(g.limitToLast)),g&&g.startAt&&(n=n.startAt(g.startAt)),g&&g.endAt&&(n=n.endAt(g.endAt)),g&&g.equalTo&&(n=n.equalTo(g.equalTo)),n.on('child_added',function(o){return o?m.push(o.val()):l(new Error('Firebase Error: the admin.database.ref in databaseSearch() is originating the error.'))}),n.once('value',function(){k(j&&j.reverse?m.reverse():m)})})},databaseRead=function(a){var b=a.entity,c=a.branch,d=c===void 0?[]:c,f=a.boundaries,g=f===void 0?{}:f,h=a.order,j=h===void 0?{}:h;return new Promise(function(k){var n=admin.database().ref('/'+b+'/'+_lodash2.default.join(d,'/'));n.once('value',function(o){k(o.val())})})},databaseReadSingle=function(a){var b=a.entity,c=a.branch,d=c===void 0?[]:c,f=a.boundaries,g=f===void 0?{}:f,h=a.order,j=h===void 0?{}:h;return new Promise(function(k){var n=admin.database().ref('/'+b+'/'+_lodash2.default.join(d,'/'));n.once('value',function(o){k(o.val())})})};function databaseWrite(a){var b=a.entity,c=a.branch,d=c===void 0?[]:c,f=a.payload,g=f===void 0?{}:f,h=a.config,j=h===void 0?{}:h,k=a.boundaries,l=k===void 0?{}:k,m=a.order,n=m===void 0?{}:m;if(!entityCorrect(b))return!1;var o=admin.database().ref(b+'/'+_lodash2.default.join(d,'/'));switch(j.writeType){case'push':try{var p=o.push(_extends({},g)),q=admin.database().ref(b+'/'+(_lodash2.default.join(d,'/')+'/'+p));return console.log(p),console.log(q),q.update({pointer:p}),p}catch(p){return{message:p.message}}break;case'update':try{var p=o.update(_extends({},g));return p}catch(p){return{message:p.message}}break;case'set':try{var p=o.set(_extends({},g));return p}catch(p){return{message:p.message}}break;default:return{message:'error: databaseWrite failed because writeType default is null. Please select push, update or set.'};}}var isObject=function(a){return!('[object Object]'!==Object.prototype.toString(a))},toArray=function(a){console.log(a);var b=[];return a.forEach(function(c){var d=c.val();isObject(d)&&(d.id=c.key),b.push(d)}),b},entityCorrect=function(a){return['self','community','organization','infrastructure','mutate'].filter(function(b){return!(a!==b)})},typeCorrect=function(a){return['create','update','patch'].filter(function(b){return!(a!==b)})};module.exports={databaseRead:databaseRead,databaseReadSingle:databaseReadSingle,databaseWrite:databaseWrite};
//# sourceMappingURL=index.js.map