"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _bodyParser=require("body-parser"),_bodyParser2=_interopRequireDefault(_bodyParser),_express=require("express"),_express2=_interopRequireDefault(_express),_graphqlServerExpress=require("graphql-server-express"),_schemaPrinter=require("graphql/utilities/schemaPrinter"),_schema=require("./data/schema"),_schema2=_interopRequireDefault(_schema);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var admin=require("firebase-admin"),cookieParser=require("cookie-parser")(),cors=require("cors")({origin:!0}),validateFirebaseIdToken=function(a,b,c){if((!a.headers.authorization||!a.headers.authorization.startsWith("Bearer "))&&!a.cookies.__session)return console.error("No Firebase ID token was passed as a Bearer token in the Authorization header.","Make sure you authorize your request by providing the following HTTP header:","Authorization: Bearer <Firebase ID Token>","or by passing a \"__session\" cookie."),void b.status(403).send("Unauthorized");var d;d=a.headers.authorization&&a.headers.authorization.startsWith("Bearer ")?a.headers.authorization.split("Bearer ")[1]:a.cookies.__session,admin.auth().verifyIdToken(d).then(function(e){a.user=e,c()}).catch(function(){b.status(403).send("Unauthorized")})},setupGraphQLServer=function(){var a=(0,_express2.default)();return a.use(cors),a.use(cookieParser),a.use("/graphql",_bodyParser2.default.json(),(0,_graphqlServerExpress.graphqlExpress)({schema:_schema2.default,context:{}})),a.use("/graphiql",(0,_graphqlServerExpress.graphiqlExpress)({endpointURL:"/api/graphql"})),a.use("/schema",function(b,c){c.set("Content-Type","text/plain"),c.send((0,_schemaPrinter.printSchema)(_schema2.default))}),a};exports.default=setupGraphQLServer,module.exports=exports["default"];
//# sourceMappingURL=index.js.map